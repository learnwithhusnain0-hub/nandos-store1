<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NANDOS - UK's Fastest Fast Food Delivery</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #E31837;
            --primary-dark: #C4122F;
            --secondary: #00A651;
            --accent: #FFA500;
            --light: #F8F9FA;
            --dark: #212529;
            --gray: #6C757D;
            --light-gray: #E9ECEF;
            --white: #FFFFFF;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --radius: 10px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--light);
            color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* Login Page */
        .login-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
        }

        .login-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 400px;
            padding: 40px 30px;
            text-align: center;
        }

        .logo {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .tagline {
            color: var(--gray);
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--light-gray);
            border-radius: var(--radius);
            font-size: 16px;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(227, 24, 55, 0.1);
        }

        .btn {
            display: inline-block;
            padding: 14px 28px;
            background-color: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: #008F47;
        }

        .btn-logout {
            background-color: #dc3545;
        }

        .btn-logout:hover {
            background-color: #c82333;
        }

        /* OTP Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .otp-modal {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 350px;
            overflow: hidden;
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .iphone-notification {
            background: var(--white);
            border-radius: 20px 20px 0 0;
            overflow: hidden;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .notification-header {
            background: #F2F2F7;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #E5E5EA;
            position: relative;
        }

        .notification-time {
            position: absolute;
            left: 20px;
            top: 20px;
            font-size: 14px;
            color: var(--dark);
            font-weight: 600;
        }

        .notification-battery {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 14px;
            color: var(--dark);
        }

        .notification-content {
            padding: 30px 20px;
            text-align: center;
        }

        .notification-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .otp-code {
            font-size: 42px;
            font-weight: 700;
            letter-spacing: 10px;
            color: var(--dark);
            margin: 20px 0;
            font-family: monospace;
        }

        .otp-input {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .otp-digit {
            width: 50px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            transition: var(--transition);
        }

        .otp-digit:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(227, 24, 55, 0.1);
        }

        /* Main App */
        .app {
            display: none;
            min-height: 100vh;
        }

        /* Navbar */
        .navbar {
            background: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 15px 0;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .nav-link i {
            font-size: 1.2rem;
        }

        .cart-count {
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            margin-left: 5px;
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            color: var(--white);
            padding: 80px 0;
            text-align: center;
            border-radius: 0 0 var(--radius) var(--radius);
            margin-bottom: 40px;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 600px;
            margin: 0 auto 30px;
            opacity: 0.9;
        }

        .contact-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        /* Products */
        .section-title {
            font-size: 2rem;
            text-align: center;
            margin: 40px 0 30px;
            color: var(--dark);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .product-card {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .product-image {
            height: 200px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--gray);
        }

        .product-content {
            padding: 20px;
        }

        .product-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .original-price {
            color: var(--gray);
            text-decoration: line-through;
            font-size: 1rem;
        }

        .discounted-price {
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .discount-badge {
            background: var(--secondary);
            color: var(--white);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .btn-add-to-cart {
            width: 100%;
            margin-top: 10px;
        }

        /* Pages */
        .page {
            display: none;
            padding: 40px 0;
            min-height: calc(100vh - 100px);
        }

        .page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cart */
        .cart-items {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .cart-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
            align-items: center;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 80px;
            height: 80px;
            background: var(--light-gray);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--gray);
        }

        .cart-item-details h4 {
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.2rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--light-gray);
            background: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .quantity-btn:hover {
            background: var(--light-gray);
        }

        .quantity {
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }

        .cart-total {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            text-align: right;
        }

        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .total-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            border-top: 2px solid var(--light-gray);
            padding-top: 15px;
            margin-top: 15px;
        }

        /* Checkout */
        .checkout-form {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card-input-wrapper {
            position: relative;
        }

        .card-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 1.2rem;
        }

        .order-success {
            text-align: center;
            padding: 40px;
        }

        .success-icon {
            font-size: 5rem;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        /* Profile */
        .profile-card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .user-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .info-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .info-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .section-divider {
            height: 1px;
            background: var(--light-gray);
            margin: 30px 0;
        }

        /* Admin */
        .admin-login {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 40px;
            max-width: 400px;
            margin: 40px auto;
        }

        .admin-panel {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .admin-tab.active {
            color: var(--primary);
            background: var(--light);
            border-bottom: 3px solid var(--primary);
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
        }

        .admin-table th,
        .admin-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .admin-table th {
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
            margin-right: 5px;
        }

        .edit-btn {
            background: var(--secondary);
            color: var(--white);
        }

        .delete-btn {
            background: #dc3545;
            color: var(--white);
        }

        .view-btn {
            background: var(--primary);
            color: var(--white);
        }

        /* Footer */
        .footer {
            background: var(--dark);
            color: var(--white);
            padding: 40px 0;
            margin-top: 60px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-logo {
            font-size: 2rem;
            font-weight: 800;
            color: var(--white);
        }

        .admin-access {
            color: var(--gray);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 5px;
        }

        .admin-access:hover {
            background: rgba(255,255,255,0.1);
            color: var(--white);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                width: 100%;
                background: var(--white);
                flex-direction: column;
                padding: 20px;
                box-shadow: var(--shadow);
                gap: 20px;
            }

            .nav-links.active {
                display: flex;
            }

            .hamburger {
                display: block;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .user-info {
                grid-template-columns: 1fr;
            }

            .contact-info {
                flex-direction: column;
                gap: 15px;
            }

            .admin-table {
                display: block;
                overflow-x: auto;
            }
        }

        /* Badge for new orders */
        .new-order-badge {
            background: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        /* Card Details Display */
        .card-details-box {
            background: var(--light);
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }

        /* Logout Button in Profile */
        .logout-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid var(--light-gray);
        }

        /* Order Details */
        .order-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--secondary);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-card">
            <div class="logo">NANDOS</div>
            <p class="tagline">UK's Fastest Fast Food Delivery</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" placeholder="example@gmail.com" required>
                    <small style="color: var(--gray); margin-top: 5px; display: block;">Only Gmail addresses accepted</small>
                </div>
                
                <div class="form-group">
                    <label for="phone">UK Phone Number</label>
                    <input type="tel" id="phone" class="form-control" placeholder="+44 7123 456789" required>
                </div>
                
                <button type="submit" class="btn">Continue to OTP</button>
            </form>
            
            <div style="margin-top: 20px; font-size: 0.9rem; color: var(--gray);">
                <p>By continuing, you agree to our Terms and Privacy Policy</p>
            </div>
        </div>
    </div>

    <!-- OTP Modal -->
    <div class="modal-overlay" id="otpModal" style="display: none;">
        <div class="otp-modal">
            <div class="iphone-notification">
                <div class="notification-header">
                    <div class="notification-time">9:41</div>
                    <div class="notification-battery">84%</div>
                    <div style="font-weight: 600;">Messages</div>
                </div>
                <div class="notification-content">
                    <div class="notification-icon">üì±</div>
                    <h3 style="margin-bottom: 10px;">Message from NANDOS</h3>
                    <p style="color: var(--gray); margin-bottom: 20px;">Your verification code:</p>
                    <div class="otp-code" id="generatedOTP">4 8 2 1</div>
                    <p style="font-size: 0.9rem; color: var(--gray);">Enter this code in the website to verify your account</p>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <p style="margin-bottom: 15px; text-align: center; font-weight: 600;">Enter OTP Code</p>
                <div class="otp-input">
                    <input type="text" class="otp-digit" maxlength="1" data-index="1">
                    <input type="text" class="otp-digit" maxlength="1" data-index="2">
                    <input type="text" class="otp-digit" maxlength="1" data-index="3">
                    <input type="text" class="otp-digit" maxlength="1" data-index="4">
                </div>
                <button class="btn btn-secondary" id="verifyOTP" style="margin-top: 20px;">Verify & Login</button>
                <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--gray);">
                    Didn't receive code? <a href="#" style="color: var(--primary);" id="resendOTP">Resend</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app" id="mainApp">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="container">
                <a href="#" class="nav-logo">NANDOS</a>
                
                <div class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </div>
                
                <div class="nav-links" id="navLinks">
                    <a href="#" class="nav-link" data-page="home">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="#" class="nav-link" data-page="cart">
                        <i class="fas fa-shopping-cart"></i> Cart
                        <span class="cart-count" id="cartCount">0</span>
                    </a>
                    <a href="#" class="nav-link" data-page="profile">
                        <i class="fas fa-user"></i> Profile
                    </a>
                    <a href="#" class="nav-link" id="adminLink" style="display: none;">
                        <i class="fas fa-lock"></i> Admin
                    </a>
                </div>
            </div>
        </nav>

        <!-- Home Page -->
        <div class="page active" id="homePage">
            <div class="hero">
                <div class="container">
                    <h1>NANDOS</h1>
                    <p>UK's Fastest Fast Food Delivery Service</p>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>Main Branch: London | Mini Branches: All Over UK</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span>+44 20 7123 4567</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container">
                <h2 class="section-title">Our Menu</h2>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Cart Page -->
        <div class="page" id="cartPage">
            <div class="container">
                <h2 class="section-title">Your Cart</h2>
                <div class="cart-items" id="cartItems">
                    <!-- Cart items will be loaded here -->
                </div>
                <div class="cart-total">
                    <div class="total-line">
                        <span>Subtotal</span>
                        <span id="cartSubtotal">¬£0.00</span>
                    </div>
                    <div class="total-line">
                        <span>Delivery</span>
                        <span>¬£2.99</span>
                    </div>
                    <div class="total-line total-amount">
                        <span>Total</span>
                        <span id="cartTotal">¬£0.00</span>
                    </div>
                    <button class="btn" id="checkoutBtn" style="margin-top: 20px;">Proceed to Checkout</button>
                </div>
            </div>
        </div>

        <!-- Checkout Page -->
        <div class="page" id="checkoutPage">
            <div class="container">
                <h2 class="section-title">Checkout</h2>
                <div class="checkout-form">
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px;">Payment Details</h3>
                        <p style="color: var(--gray);">Enter your card information to complete the order</p>
                    </div>
                    
                    <form id="paymentForm">
                        <div class="form-group">
                            <label for="cardNumber">Card Number</label>
                            <div class="card-input-wrapper">
                                <input type="text" id="cardNumber" class="form-control" placeholder="4242 4242 4242 4242" maxlength="19">
                                <div class="card-icon">
                                    <i class="fab fa-cc-visa"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expiry">Expiry Date (MM/YY)</label>
                                <input type="text" id="expiry" class="form-control" placeholder="12/25" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label for="cvc">CVC</label>
                                <input type="text" id="cvc" class="form-control" placeholder="123" maxlength="3">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cardName">Name on Card</label>
                            <input type="text" id="cardName" class="form-control" placeholder="John Doe">
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Delivery Address</label>
                            <input type="text" id="address" class="form-control" placeholder="123 Main Street, London, UK" required>
                        </div>
                        
                        <div style="margin: 20px 0; padding: 15px; background: var(--light); border-radius: var(--radius);">
                            <i class="fas fa-info-circle"></i> Your card details will be saved for faster checkout next time.
                        </div>
                        
                        <button type="submit" class="btn" id="payNowBtn">
                            <i class="fas fa-lock"></i> Pay Now & Place Order
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Order Success Page -->
        <div class="page" id="orderSuccessPage">
            <div class="container">
                <div class="order-success">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>Order Confirmed!</h2>
                    <p style="font-size: 1.2rem; margin: 20px 0; color: var(--gray);">
                        Thank you for your order. Your fast food will be delivered within 30 minutes.
                    </p>
                    <p style="margin-bottom: 30px;">
                        Order ID: <strong id="orderIdDisplay">NANDOS-#2024-001</strong>
                    </p>
                    <button class="btn" id="continueShoppingBtn">Continue Shopping</button>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div class="page" id="profilePage">
            <div class="container">
                <h2 class="section-title">Your Profile</h2>
                <div class="profile-card">
                    <h3 style="margin-bottom: 20px;">Personal Information</h3>
                    <div class="user-info" id="userInfo">
                        <!-- User info will be loaded here -->
                    </div>
                    
                    <div class="section-divider"></div>
                    
                    <h3 style="margin-bottom: 20px;">Order History</h3>
                    <div id="orderHistory">
                        <p style="color: var(--gray); text-align: center; padding: 20px;">
                            Loading your orders...
                        </p>
                    </div>

                    <div class="section-divider"></div>
                    
                    <h3 style="margin-bottom: 20px;">Saved Card Details</h3>
                    <div id="savedCards">
                        <p style="color: var(--gray); text-align: center; padding: 20px;">
                            Loading your saved cards...
                        </p>
                    </div>

                    <div class="logout-section">
                        <button class="btn btn-logout" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                        <p style="margin-top: 15px; color: var(--gray); font-size: 0.9rem;">
                            Logging out will clear your cart and require OTP verification next time.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="page" id="adminPage">
            <div class="container">
                <h2 class="section-title">Admin Panel</h2>
                
                <div id="adminLoginForm">
                    <div class="admin-login">
                        <h3 style="text-align: center; margin-bottom: 30px;">Admin Login</h3>
                        <div class="form-group">
                            <label for="adminUsername">Username</label>
                            <input type="text" id="adminUsername" class="form-control" placeholder="Enter username">
                        </div>
                        <div class="form-group">
                            <label for="adminPassword">Password</label>
                            <input type="password" id="adminPassword" class="form-control" placeholder="Enter password">
                        </div>
                        <button class="btn" id="adminLoginBtn">Login as Admin</button>
                        <p style="text-align: center; margin-top: 20px; color: var(--gray); font-size: 0.9rem;">
                            Use: Username: <strong>Husnain</strong>, Password: <strong>03038776223</strong>
                        </p>
                    </div>
                </div>
                
                <div id="adminPanel" style="display: none;">
                    <div class="admin-panel">
                        <div class="admin-tabs">
                            <button class="admin-tab active" data-tab="products">Products</button>
                            <button class="admin-tab" data-tab="users">All Users</button>
                            <button class="admin-tab" data-tab="cards">Card Details</button>
                            <button class="admin-tab" data-tab="orders">All Orders <span class="new-order-badge" id="newOrdersCount">0</span></button>
                            <button class="admin-tab" data-tab="ordersWithCards">Orders with Cards</button>
                        </div>
                        
                        <!-- Products Tab -->
                        <div class="admin-content active" id="productsTab">
                            <h3 style="margin-bottom: 20px;">Manage Products</h3>
                            <button class="btn" id="addProductBtn" style="margin-bottom: 20px;">
                                <i class="fas fa-plus"></i> Add New Product
                            </button>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Name</th>
                                        <th>Price</th>
                                        <th>Discount</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- Products will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Users Tab -->
                        <div class="admin-content" id="usersTab">
                            <h3 style="margin-bottom: 20px;">All Registered Users</h3>
                            <div style="margin-bottom: 20px; color: var(--gray);">
                                <i class="fas fa-users"></i> Total Users: <span id="totalUsersCount">0</span>
                            </div>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Registration Date</th>
                                        <th>Total Orders</th>
                                        <th>Total Spent</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Card Details Tab -->
                        <div class="admin-content" id="cardsTab">
                            <h3 style="margin-bottom: 20px;">All Saved Card Details</h3>
                            <div style="margin-bottom: 20px; padding: 15px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-shield-alt"></i> This section shows all card details saved by users during checkout.
                            </div>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Card Number</th>
                                        <th>Name on Card</th>
                                        <th>Expiry</th>
                                        <th>CVV</th>
                                        <th>Last Used</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="cardsTableBody">
                                    <!-- Card details will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Orders Tab -->
                        <div class="admin-content" id="ordersTab">
                            <h3 style="margin-bottom: 20px;">All Customer Orders</h3>
                            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                                <button class="btn" id="markAllShipped" style="width: auto;">
                                    <i class="fas fa-truck"></i> Mark All as Shipped
                                </button>
                                <button class="btn btn-secondary" id="refreshOrders" style="width: auto;">
                                    <i class="fas fa-sync"></i> Refresh
                                </button>
                            </div>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Customer</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Address</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <!-- Orders will be loaded here -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Orders with Cards Tab -->
                        <div class="admin-content" id="ordersWithCardsTab">
                            <h3 style="margin-bottom: 20px;">Orders with Card Details</h3>
                            <p style="color: var(--gray); margin-bottom: 20px;">
                                View complete order details including payment information used for each order.
                            </p>
                            <div id="ordersWithCardsContainer">
                                <!-- Orders with card details will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-logo">NANDOS</div>
                    <div>
                        <p style="margin-bottom: 10px;">¬© 2024 NANDOS Fast Food Delivery. All rights reserved.</p>
                        <p style="color: var(--gray); font-size: 0.9rem;">
                            Main Branch: London | Contact: +44 20 7123 4567
                        </p>
                    </div>
                    <div class="admin-access" id="footerAdminLink">
                        <i class="fas fa-shield-alt"></i> Admin Access
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Add Product Modal -->
    <div class="modal-overlay" id="addProductModal" style="display: none;">
        <div class="otp-modal" style="max-width: 500px;">
            <div style="padding: 30px;">
                <h3 style="margin-bottom: 20px;">Add New Product</h3>
                <form id="addProductForm">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" id="productName" class="form-control" placeholder="e.g., Zinger Burger" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productPrice">Price (¬£)</label>
                        <input type="number" id="productPrice" class="form-control" placeholder="e.g., 4.99" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDiscount">Discount (%)</label>
                        <input type="number" id="productDiscount" class="form-control" placeholder="e.g., 20" min="0" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label for="productImage">Product Image</label>
                        <select id="productImage" class="form-control">
                            <option value="üçî">üçî Burger</option>
                            <option value="üçü">üçü Fries</option>
                            <option value="üå≠">üå≠ Hot Dog</option>
                            <option value="üçï">üçï Pizza</option>
                            <option value="ü•§">ü•§ Drink</option>
                            <option value="üçó">üçó Chicken</option>
                            <option value="üåØ">üåØ Wrap</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="button" class="btn" style="background: var(--gray);" id="cancelAddProduct">
                            Cancel
                        </button>
                        <button type="submit" class="btn">
                            Save Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Card Details Modal -->
    <div class="modal-overlay" id="viewCardModal" style="display: none;">
        <div class="otp-modal" style="max-width: 500px;">
            <div style="padding: 30px;">
                <h3 style="margin-bottom: 20px;">Card Details</h3>
                <div id="cardDetailsContent">
                    <!-- Card details will be loaded here -->
                </div>
                <button class="btn" style="margin-top: 20px;" id="closeCardModal">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==============================
        // SERVER STORAGE SYSTEM
        // ==============================
        class ServerStorage {
            constructor() {
                this.STORAGE_KEY = 'nandos_server_data_v2';
                this.initServer();
            }
            
            initServer() {
                if (!localStorage.getItem(this.STORAGE_KEY)) {
                    const initialData = {
                        users: [],
                        orders: [],
                        products: this.getDefaultProducts(),
                        cardDetails: [], // Stores ALL card details
                        adminCredentials: {
                            username: 'Husnain',
                            password: '03038776223'
                        }
                    };
                    this.saveData(initialData);
                }
            }
            
            getDefaultProducts() {
                return [
                    {
                        id: 1,
                        name: "Zinger Burger",
                        price: 4.99,
                        discount: 20,
                        image: "üçî",
                        originalPrice: 6.24
                    },
                    {
                        id: 2,
                        name: "Peri Peri Fries",
                        price: 2.49,
                        discount: 15,
                        image: "üçü",
                        originalPrice: 2.93
                    },
                    {
                        id: 3,
                        name: "Chicken Wrap",
                        price: 3.99,
                        discount: 20,
                        image: "üåØ",
                        originalPrice: 4.99
                    },
                    {
                        id: 4,
                        name: "Pizza Slice",
                        price: 1.99,
                        discount: 25,
                        image: "üçï",
                        originalPrice: 2.65
                    },
                    {
                        id: 5,
                        name: "Coke + Fries Combo",
                        price: 3.49,
                        discount: 15,
                        image: "ü•§",
                        originalPrice: 4.11
                    },
                    {
                        id: 6,
                        name: "Spicy Chicken Wings",
                        price: 5.99,
                        discount: 10,
                        image: "üçó",
                        originalPrice: 6.66
                    }
                ];
            }
            
            getData() {
                return JSON.parse(localStorage.getItem(this.STORAGE_KEY));
            }
            
            saveData(data) {
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
            }
            
            // User Management
            addUser(user) {
                const data = this.getData();
                // Check if user already exists
                const existingUser = data.users.find(u => u.email === user.email);
                if (!existingUser) {
                    user.id = Date.now();
                    user.registrationDate = new Date().toISOString();
                    user.totalOrders = 0;
                    user.totalSpent = 0;
                    user.lastLogin = new Date().toISOString();
                    data.users.push(user);
                    this.saveData(data);
                } else {
                    // Update last login
                    existingUser.lastLogin = new Date().toISOString();
                    this.saveData(data);
                }
                return user;
            }
            
            getUserByEmail(email) {
                const data = this.getData();
                return data.users.find(u => u.email === email);
            }
            
            getAllUsers() {
                return this.getData().users;
            }
            
            // Card Details Management
            saveCardDetails(cardData) {
                const data = this.getData();
                
                // Remove spaces from card number
                cardData.cardNumber = cardData.cardNumber.replace(/\s/g, '');
                
                // Check if card already exists for this user
                const existingIndex = data.cardDetails.findIndex(
                    c => c.userEmail === cardData.userEmail && 
                    c.cardNumber === cardData.cardNumber
                );
                
                if (existingIndex !== -1) {
                    // Update existing
                    data.cardDetails[existingIndex] = {
                        ...data.cardDetails[existingIndex],
                        ...cardData,
                        lastUsed: new Date().toISOString(),
                        timesUsed: (data.cardDetails[existingIndex].timesUsed || 1) + 1
                    };
                } else {
                    // Add new card
                    cardData.id = 'CARD-' + Date.now();
                    cardData.lastUsed = new Date().toISOString();
                    cardData.timesUsed = 1;
                    cardData.saveDate = new Date().toISOString();
                    data.cardDetails.push(cardData);
                }
                
                this.saveData(data);
                return cardData;
            }
            
            getCardsByUser(email) {
                const data = this.getData();
                return data.cardDetails.filter(card => card.userEmail === email)
                    .sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed));
            }
            
            getAllCardDetails() {
                return this.getData().cardDetails;
            }
            
            // Order Management with Card Linking
            addOrder(order) {
                const data = this.getData();
                order.id = 'ORD-' + Date.now();
                order.orderDate = new Date().toISOString();
                order.status = 'Pending';
                order.cardLastFour = order.cardNumber ? order.cardNumber.slice(-4) : 'N/A';
                
                // Link card details to order if available
                if (order.cardNumber) {
                    order.linkedCard = {
                        lastFour: order.cardNumber.slice(-4),
                        name: order.cardName,
                        expiry: order.expiry
                    };
                }
                
                data.orders.unshift(order); // Add to beginning
                
                // Update user stats
                const user = data.users.find(u => u.email === order.userEmail);
                if (user) {
                    user.totalOrders = (user.totalOrders || 0) + 1;
                    user.totalSpent = (user.totalSpent || 0) + order.total;
                    user.lastOrderDate = new Date().toISOString();
                }
                
                this.saveData(data);
                return order;
            }
            
            getOrdersByUser(email) {
                const data = this.getData();
                return data.orders.filter(order => order.userEmail === email)
                    .sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate));
            }
            
            getAllOrders() {
                return this.getData().orders;
            }
            
            getOrdersWithCards() {
                const data = this.getData();
                return data.orders.filter(order => order.cardNumber);
            }
            
            updateOrderStatus(orderId, status) {
                const data = this.getData();
                const order = data.orders.find(o => o.id === orderId);
                if (order) {
                    order.status = status;
                    this.saveData(data);
                    return true;
                }
                return false;
            }
            
            markAllOrdersShipped() {
                const data = this.getData();
                data.orders.forEach(order => {
                    if (order.status === 'Pending') {
                        order.status = 'Shipped';
                    }
                });
                this.saveData(data);
            }
            
            // Product Management
            getAllProducts() {
                return this.getData().products;
            }
            
            addProduct(product) {
                const data = this.getData();
                product.id = data.products.length > 0 ? 
                    Math.max(...data.products.map(p => p.id)) + 1 : 1;
                data.products.push(product);
                this.saveData(data);
                return product;
            }
            
            updateProduct(productId, updates) {
                const data = this.getData();
                const index = data.products.findIndex(p => p.id === productId);
                if (index !== -1) {
                    data.products[index] = { ...data.products[index], ...updates };
                    this.saveData(data);
                    return true;
                }
                return false;
            }
            
            deleteProduct(productId) {
                const data = this.getData();
                const initialLength = data.products.length;
                data.products = data.products.filter(p => p.id !== productId);
                this.saveData(data);
                return data.products.length < initialLength;
            }
            
            // Admin Authentication
            verifyAdmin(username, password) {
                const data = this.getData();
                return data.adminCredentials.username === username && 
                       data.adminCredentials.password === password;
            }
            
            getPendingOrdersCount() {
                const data = this.getData();
                return data.orders.filter(order => order.status === 'Pending').length;
            }
            
            // Get statistics
            getStatistics() {
                const data = this.getData();
                return {
                    totalUsers: data.users.length,
                    totalOrders: data.orders.length,
                    totalCards: data.cardDetails.length,
                    pendingOrders: data.orders.filter(o => o.status === 'Pending').length,
                    totalRevenue: data.orders.reduce((sum, order) => sum + order.total, 0)
                };
            }
        }

        // ==============================
        // APPLICATION STATE
        // ==============================
        const state = {
            currentUser: null,
            cart: [],
            isAdmin: false,
            currentOTP: null
        };

        // Initialize server storage
        const server = new ServerStorage();

        // ==============================
        // DOM ELEMENTS
        // ==============================
        const loginPage = document.getElementById('loginPage');
        const mainApp = document.getElementById('mainApp');
        const otpModal = document.getElementById('otpModal');
        const loginForm = document.getElementById('loginForm');
        const verifyOTP = document.getElementById('verifyOTP');
        const resendOTP = document.getElementById('resendOTP');
        const otpDigits = document.querySelectorAll('.otp-digit');
        const generatedOTP = document.getElementById('generatedOTP');
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const hamburger = document.getElementById('hamburger');
        const navLinksContainer = document.getElementById('navLinks');
        const cartCount = document.getElementById('cartCount');
        const productsGrid = document.getElementById('productsGrid');
        const cartItems = document.getElementById('cartItems');
        const cartSubtotal = document.getElementById('cartSubtotal');
        const cartTotal = document.getElementById('cartTotal');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const paymentForm = document.getElementById('paymentForm');
        const continueShoppingBtn = document.getElementById('continueShoppingBtn');
        const userInfo = document.getElementById('userInfo');
        const orderHistory = document.getElementById('orderHistory');
        const savedCards = document.getElementById('savedCards');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminLink = document.getElementById('adminLink');
        const footerAdminLink = document.getElementById('footerAdminLink');
        const adminLoginForm = document.getElementById('adminLoginForm');
        const adminPanel = document.getElementById('adminPanel');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const adminTabs = document.querySelectorAll('.admin-tab');
        const adminContents = document.querySelectorAll('.admin-content');
        const productsTableBody = document.getElementById('productsTableBody');
        const usersTableBody = document.getElementById('usersTableBody');
        const cardsTableBody = document.getElementById('cardsTableBody');
        const ordersTableBody = document.getElementById('ordersTableBody');
        const ordersWithCardsContainer = document.getElementById('ordersWithCardsContainer');
        const addProductBtn = document.getElementById('addProductBtn');
        const addProductModal = document.getElementById('addProductModal');
        const addProductForm = document.getElementById('addProductForm');
        const cancelAddProduct = document.getElementById('cancelAddProduct');
        const markAllShipped = document.getElementById('markAllShipped');
        const refreshOrders = document.getElementById('refreshOrders');
        const totalUsersCount = document.getElementById('totalUsersCount');
        const newOrdersCount = document.getElementById('newOrdersCount');
        const orderIdDisplay = document.getElementById('orderIdDisplay');
        const viewCardModal = document.getElementById('viewCardModal');
        const cardDetailsContent = document.getElementById('cardDetailsContent');
        const closeCardModal = document.getElementById('closeCardModal');
        const cardNumberInput = document.getElementById('cardNumber');
        const expiryInput = document.getElementById('expiry');

        // ==============================
        // INITIALIZATION
        // ==============================
        function init() {
            // Check if user is already logged in
            const savedUser = localStorage.getItem('nandos_current_user');
            if (savedUser) {
                state.currentUser = JSON.parse(savedUser);
                loginPage.style.display = 'none';
                mainApp.style.display = 'block';
                updateCartCount();
                loadProducts();
                loadUserProfile();
                
                // Check if user is admin
                if (state.currentUser.email === 'admin@gmail.com' || 
                    server.verifyAdmin(state.currentUser.email, state.currentUser.password)) {
                    adminLink.style.display = 'flex';
                    state.isAdmin = true;
                }
            }
        }

        // ==============================
        // GENERATE RANDOM OTP
        // ==============================
        function generateRandomOTP() {
            return Math.floor(1000 + Math.random() * 9000).toString();
        }

        // ==============================
        // LOGOUT FUNCTION
        // ==============================
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear current user
                localStorage.removeItem('nandos_current_user');
                state.currentUser = null;
                state.cart = [];
                state.isAdmin = false;
                
                // Reset UI
                loginPage.style.display = 'flex';
                mainApp.style.display = 'none';
                adminLink.style.display = 'none';
                
                // Clear login form
                document.getElementById('email').value = '';
                document.getElementById('phone').value = '';
                
                showNotification('You have been logged out successfully.');
            }
        }

        // ==============================
        // PRODUCT FUNCTIONS
        // ==============================
        function loadProducts() {
            productsGrid.innerHTML = '';
            const products = server.getAllProducts();
            
            products.forEach(product => {
                const discountedPrice = product.price;
                const originalPrice = product.originalPrice || (product.price / (1 - product.discount / 100)).toFixed(2);
                
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.innerHTML = `
                    <div class="product-image">
                        <span style="font-size: 3rem;">${product.image}</span>
                    </div>
                    <div class="product-content">
                        <h3 class="product-title">${product.name}</h3>
                        <div class="product-price">
                            <span class="discounted-price">¬£${discountedPrice.toFixed(2)}</span>
                            <span class="original-price">¬£${originalPrice}</span>
                            <span class="discount-badge">-${product.discount}%</span>
                        </div>
                        <button class="btn btn-add-to-cart" data-id="${product.id}">
                            <i class="fas fa-cart-plus"></i> Add to Cart
                        </button>
                    </div>
                `;
                
                productsGrid.appendChild(productCard);
            });
            
            // Add event listeners to Add to Cart buttons
            document.querySelectorAll('.btn-add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    addToCart(productId);
                });
            });
        }

        // ==============================
        // CART FUNCTIONS
        // ==============================
        function addToCart(productId) {
            const products = server.getAllProducts();
            const product = products.find(p => p.id === productId);
            
            if (!product) return;
            
            const existingItem = state.cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity++;
            } else {
                state.cart.push({
                    ...product,
                    quantity: 1
                });
            }
            
            updateCartCount();
            showNotification(`${product.name} added to cart!`);
        }

        function updateCartCount() {
            const totalItems = state.cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
        }

        function loadCartItems() {
            if (state.cart.length === 0) {
                cartItems.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add some delicious fast food items to get started!</p>
                    </div>
                `;
                cartSubtotal.textContent = '¬£0.00';
                cartTotal.textContent = '¬£2.99';
                return;
            }
            
            cartItems.innerHTML = '';
            let subtotal = 0;
            
            state.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image">
                        <span style="font-size: 2rem;">${item.image}</span>
                    </div>
                    <div class="cart-item-details">
                        <h4>${item.name}</h4>
                        <div class="cart-item-price">¬£${item.price.toFixed(2)} each</div>
                    </div>
                    <div class="quantity-control">
                        <button class="quantity-btn" data-id="${item.id}" data-action="decrease">
                            <i class="fas fa-minus"></i>
                        </button>
                        <span class="quantity">${item.quantity}</span>
                        <button class="quantity-btn" data-id="${item.id}" data-action="increase">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            cartSubtotal.textContent = `¬£${subtotal.toFixed(2)}`;
            const total = subtotal + 2.99;
            cartTotal.textContent = `¬£${total.toFixed(2)}`;
            
            // Add event listeners to quantity buttons
            document.querySelectorAll('.quantity-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    const action = this.getAttribute('data-action');
                    updateCartQuantity(productId, action);
                });
            });
        }

        function updateCartQuantity(productId, action) {
            const item = state.cart.find(item => item.id === productId);
            
            if (!item) return;
            
            if (action === 'increase') {
                item.quantity++;
            } else if (action === 'decrease') {
                item.quantity--;
                if (item.quantity <= 0) {
                    state.cart = state.cart.filter(item => item.id !== productId);
                }
            }
            
            loadCartItems();
            updateCartCount();
        }

        // ==============================
        // USER PROFILE FUNCTIONS
        // ==============================
        function loadUserProfile() {
            if (!state.currentUser) return;
            
            const user = server.getUserByEmail(state.currentUser.email);
            const orders = server.getOrdersByUser(state.currentUser.email);
            const userCards = server.getCardsByUser(state.currentUser.email);
            
            userInfo.innerHTML = `
                <div class="info-item">
                    <span class="info-label">Email Address</span>
                    <span class="info-value">${state.currentUser.email}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Phone Number</span>
                    <span class="info-value">${state.currentUser.phone}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Account Type</span>
                    <span class="info-value">${state.currentUser.email === 'admin@gmail.com' ? 'Administrator' : 'Customer'}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total Orders</span>
                    <span class="info-value">${orders.length}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total Spent</span>
                    <span class="info-value">¬£${orders.reduce((sum, order) => sum + order.total, 0).toFixed(2)}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Member Since</span>
                    <span class="info-value">${user ? new Date(user.registrationDate).toLocaleDateString() : 'Today'}</span>
                </div>
            `;
            
            // Load order history
            if (orders.length > 0) {
                let ordersHTML = '<div style="max-height: 300px; overflow-y: auto;">';
                orders.forEach(order => {
                    ordersHTML += `
                        <div class="order-card">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong>${order.id}</strong>
                                <span style="color: var(--primary); font-weight: 600;">¬£${order.total.toFixed(2)}</span>
                            </div>
                            <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 10px;">
                                <i class="far fa-calendar"></i> ${new Date(order.orderDate).toLocaleDateString()} ‚Ä¢ 
                                <span style="padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; 
                                      background: ${order.status === 'Pending' ? '#FFEAA7' : 
                                                    order.status === 'Shipped' ? '#A3E4D7' : '#D5DBDB'};">
                                    ${order.status}
                                </span>
                            </div>
                            <div style="font-size: 0.9rem;">
                                ${order.items.length} item${order.items.length > 1 ? 's' : ''} ‚Ä¢ 
                                ${order.address.substring(0, 30)}...
                            </div>
                            ${order.cardLastFour && order.cardLastFour !== 'N/A' ? 
                                `<div style="margin-top: 10px; font-size: 0.85rem; color: var(--gray);">
                                    <i class="far fa-credit-card"></i> Paid with card ending in ${order.cardLastFour}
                                </div>` : ''
                            }
                        </div>
                    `;
                });
                ordersHTML += '</div>';
                orderHistory.innerHTML = ordersHTML;
            } else {
                orderHistory.innerHTML = `
                    <p style="color: var(--gray); text-align: center; padding: 20px;">
                        No orders yet. Start shopping!
                    </p>
                `;
            }
            
            // Load saved cards
            if (userCards.length > 0) {
                let cardsHTML = '<div style="display: grid; gap: 15px;">';
                userCards.forEach(card => {
                    const maskedNumber = `**** **** **** ${card.cardNumber.slice(-4)}`;
                    cardsHTML += `
                        <div class="card-details-box">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${maskedNumber}</strong>
                                    <div style="font-size: 0.9rem; color: var(--gray); margin-top: 5px;">
                                        <i class="far fa-user"></i> ${card.cardName} ‚Ä¢ 
                                        <i class="far fa-calendar"></i> ${card.expiry} ‚Ä¢
                                        Used ${card.timesUsed} time${card.timesUsed > 1 ? 's' : ''}
                                    </div>
                                </div>
                                <div style="font-size: 1.5rem;">
                                    ${card.cardNumber.startsWith('4') ? 'üí≥' : 
                                      card.cardNumber.startsWith('5') ? 'üí≥' : 'üí≥'}
                                </div>
                            </div>
                            <div style="margin-top: 10px; font-size: 0.8rem; color: var(--gray);">
                                Last used: ${new Date(card.lastUsed).toLocaleDateString()}
                            </div>
                        </div>
                    `;
                });
                cardsHTML += '</div>';
                savedCards.innerHTML = cardsHTML;
            } else {
                savedCards.innerHTML = `
                    <p style="color: var(--gray); text-align: center; padding: 20px;">
                        No saved cards yet. Your card will be saved after your first order.
                    </p>
                `;
            }
        }

        // ==============================
        // ADMIN FUNCTIONS
        // ==============================
        function loadAdminProducts() {
            productsTableBody.innerHTML = '';
            const products = server.getAllProducts();
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-size: 1.5rem;">${product.image}</td>
                    <td>${product.name}</td>
                    <td>¬£${product.price.toFixed(2)}</td>
                    <td>${product.discount}%</td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                
                productsTableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.edit-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    editProduct(productId);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-id'));
                    deleteProduct(productId);
                });
            });
        }

        function loadAdminUsers() {
            usersTableBody.innerHTML = '';
            const users = server.getAllUsers();
            const stats = server.getStatistics();
            totalUsersCount.textContent = stats.totalUsers;
            
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.email}</td>
                    <td>${user.phone}</td>
                    <td>${new Date(user.registrationDate).toLocaleDateString()}</td>
                    <td>${user.totalOrders || 0}</td>
                    <td>¬£${(user.totalSpent || 0).toFixed(2)}</td>
                    <td>
                        <button class="action-btn view-btn" data-email="${user.email}">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                    </td>
                `;
                
                usersTableBody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const email = this.getAttribute('data-email');
                    viewUserDetails(email);
                });
            });
        }

        function loadAdminCards() {
            cardsTableBody.innerHTML = '';
            const cardDetails = server.getAllCardDetails();
            
            if (cardDetails.length === 0) {
                cardsTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-credit-card" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            No card details saved yet. Users need to place orders first.
                        </td>
                    </tr>
                `;
                return;
            }
            
            cardDetails.forEach(card => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${card.userEmail}</td>
                    <td><strong>${card.cardNumber}</strong></td>
                    <td>${card.cardName}</td>
                    <td>${card.expiry}</td>
                    <td>${card.cvv}</td>
                    <td>${new Date(card.lastUsed).toLocaleDateString()}</td>
                    <td>
                        <button class="action-btn view-btn" data-id="${card.id}">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                `;
                
                cardsTableBody.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('#cardsTableBody .view-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const cardId = this.getAttribute('data-id');
                    viewCardDetails(cardId);
                });
            });
        }

        function loadAdminOrders() {
            ordersTableBody.innerHTML = '';
            const orders = server.getAllOrders();
            const pendingCount = server.getPendingOrdersCount();
            newOrdersCount.textContent = pendingCount;
            
            if (orders.length === 0) {
                ordersTableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px; color: var(--gray);">
                            <i class="fas fa-shopping-bag" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            No orders placed yet.
                        </td>
                    </tr>
                `;
                return;
            }
            
            orders.forEach(order => {
                const itemsText = order.items.map(item => 
                    `${item.quantity}x ${item.name.substring(0, 15)}...`
                ).join(', ');
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${order.id}</strong></td>
                    <td>${order.userEmail}</td>
                    <td>${itemsText}</td>
                    <td>¬£${order.total.toFixed(2)}</td>
                    <td>${order.address.substring(0, 20)}...</td>
                    <td>
                        <span style="padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; 
                              background: ${order.status === 'Pending' ? '#FFEAA7' : 
                                        order.status === 'Shipped' ? '#A3E4D7' : '#D5DBDB'};">
                            ${order.status}
                        </span>
                    </td>
                    <td>${new Date(order.orderDate).toLocaleDateString()}</td>
                    <td>
                        ${order.status === 'Pending' ? 
                            `<button class="action-btn edit-btn" data-order="${order.id}">
                                <i class="fas fa-truck"></i> Ship
                            </button>` : 
                            `<span style="color: var(--gray); font-size: 0.9rem;">Shipped</span>`
                        }
                    </td>
                `;
                
                ordersTableBody.appendChild(row);
            });
            
            // Add event listeners to ship buttons
            document.querySelectorAll('#ordersTableBody .edit-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const orderId = this.getAttribute('data-order');
                    shipOrder(orderId);
                });
            });
        }

        function loadOrdersWithCards() {
            ordersWithCardsContainer.innerHTML = '';
            const orders = server.getOrdersWithCards();
            
            if (orders.length === 0) {
                ordersWithCardsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-credit-card" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h4>No orders with card details yet</h4>
                        <p>Users need to place orders with card payments first.</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div style="display: grid; gap: 20px;">';
            
            orders.forEach(order => {
                html += `
                    <div class="order-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h4 style="margin-bottom: 5px;">${order.id}</h4>
                                <div style="color: var(--gray); font-size: 0.9rem;">
                                    <i class="far fa-user"></i> ${order.userEmail} ‚Ä¢ 
                                    <i class="far fa-calendar"></i> ${new Date(order.orderDate).toLocaleDateString()}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span style="color: var(--primary); font-size: 1.2rem; font-weight: 600;">¬£${order.total.toFixed(2)}</span>
                                <div style="margin-top: 5px;">
                                    <span style="padding: 3px 10px; border-radius: 12px; font-size: 0.8rem; 
                                          background: ${order.status === 'Pending' ? '#FFEAA7' : 
                                                    order.status === 'Shipped' ? '#A3E4D7' : '#D5DBDB'};">
                                        ${order.status}
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section-divider" style="margin: 15px 0;"></div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <h5 style="margin-bottom: 10px; color: var(--dark);">Order Items</h5>
                                <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                                    ${order.items.map(item => `
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                            <span>${item.quantity}x ${item.name}</span>
                                            <span>¬£${(item.price * item.quantity).toFixed(2)}</span>
                                        </div>
                                    `).join('')}
                                    <div style="border-top: 1px solid var(--light-gray); padding-top: 10px; margin-top: 10px; font-weight: 600;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span>Total:</span>
                                            <span>¬£${order.total.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h5 style="margin-bottom: 10px; color: var(--dark);">Payment Details</h5>
                                <div class="card-details-box">
                                    <div style="margin-bottom: 10px;">
                                        <strong>Card Number:</strong>
                                        <div style="font-family: monospace; font-size: 1.1rem; margin-top: 5px;">
                                            ${order.cardNumber || 'Not available'}
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                                        <div>
                                            <div style="color: var(--gray); font-size: 0.9rem;">Card Holder</div>
                                            <div>${order.cardName || 'N/A'}</div>
                                        </div>
                                        <div>
                                            <div style="color: var(--gray); font-size: 0.9rem;">Expiry</div>
                                            <div>${order.expiry || 'N/A'}</div>
                                        </div>
                                        <div>
                                            <div style="color: var(--gray); font-size: 0.9rem;">CVV</div>
                                            <div>${order.cvv || 'N/A'}</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px;">
                                    <h5 style="margin-bottom: 10px; color: var(--dark);">Delivery Address</h5>
                                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                                        <i class="fas fa-map-marker-alt"></i> ${order.address}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            ordersWithCardsContainer.innerHTML = html;
        }

        function viewUserDetails(email) {
            const user = server.getUserByEmail(email);
            const userOrders = server.getOrdersByUser(email);
            const userCards = server.getCardsByUser(email);
            
            if (!user) return;
            
            const details = `
                <h3>User Details: ${email}</h3>
                <div style="margin: 20px 0;">
                    <p><strong>Phone:</strong> ${user.phone}</p>
                    <p><strong>Registered:</strong> ${new Date(user.registrationDate).toLocaleDateString()}</p>
                    <p><strong>Total Orders:</strong> ${user.totalOrders || 0}</p>
                    <p><strong>Total Spent:</strong> ¬£${(user.totalSpent || 0).toFixed(2)}</p>
                    <p><strong>Last Login:</strong> ${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'N/A'}</p>
                </div>
                
                <h4>Saved Cards (${userCards.length})</h4>
                ${userCards.length > 0 ? 
                    userCards.map(card => `
                        <div style="background: var(--light); padding: 10px; margin: 10px 0; border-radius: 5px;">
                            ${card.cardNumber} - ${card.cardName} (Exp: ${card.expiry})
                        </div>
                    `).join('') : 
                    '<p style="color: var(--gray);">No saved cards</p>'
                }
                
                <h4>Order History (${userOrders.length})</h4>
                ${userOrders.length > 0 ? 
                    userOrders.map(order => `
                        <div style="background: var(--light); padding: 10px; margin: 10px 0; border-radius: 5px;">
                            ${order.id} - ¬£${order.total.toFixed(2)} - ${order.status}
                        </div>
                    `).join('') : 
                    '<p style="color: var(--gray);">No orders</p>'
                }
            `;
            
            alert(details);
        }

        function viewCardDetails(cardId) {
            const cardDetails = server.getAllCardDetails();
            const card = cardDetails.find(c => c.id === cardId);
            
            if (!card) return;
            
            cardDetailsContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4>Card Details</h4>
                    <div style="background: var(--light); padding: 20px; border-radius: var(--radius); margin-top: 10px;">
                        <div style="margin-bottom: 15px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Card Holder</div>
                            <div style="font-size: 1.2rem; font-weight: 600;">${card.cardName}</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="color: var(--gray); font-size: 0.9rem;">Card Number</div>
                            <div style="font-family: monospace; font-size: 1.3rem; letter-spacing: 2px; margin-top: 5px;">
                                ${card.cardNumber}
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <div style="color: var(--gray); font-size: 0.9rem;">Expiry Date</div>
                                <div style="font-size: 1.1rem;">${card.expiry}</div>
                            </div>
                            <div>
                                <div style="color: var(--gray); font-size: 0.9rem;">CVV</div>
                                <div style="font-size: 1.1rem;">${card.cvv}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4>Card Information</h4>
                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius); margin-top: 10px;">
                        <p><strong>User:</strong> ${card.userEmail}</p>
                        <p><strong>Saved On:</strong> ${new Date(card.saveDate).toLocaleDateString()}</p>
                        <p><strong>Last Used:</strong> ${new Date(card.lastUsed).toLocaleDateString()}</p>
                        <p><strong>Times Used:</strong> ${card.timesUsed}</p>
                    </div>
                </div>
            `;
            
            viewCardModal.style.display = 'flex';
        }

        function editProduct(productId) {
            const products = server.getAllProducts();
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const newName = prompt('Enter new product name:', product.name);
            if (newName) {
                server.updateProduct(productId, { name: newName });
            }
            
            const newPrice = prompt('Enter new price:', product.price);
            if (newPrice) {
                server.updateProduct(productId, { price: parseFloat(newPrice) });
            }
            
            const newDiscount = prompt('Enter new discount (%):', product.discount);
            if (newDiscount) {
                server.updateProduct(productId, { discount: parseInt(newDiscount) });
            }
            
            loadAdminProducts();
            loadProducts();
            showNotification('Product updated successfully!');
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                if (server.deleteProduct(productId)) {
                    loadAdminProducts();
                    loadProducts();
                    showNotification('Product deleted successfully!');
                }
            }
        }

        function shipOrder(orderId) {
            if (server.updateOrderStatus(orderId, 'Shipped')) {
                loadAdminOrders();
                showNotification(`Order ${orderId} marked as shipped!`);
            }
        }

        // ==============================
        // NOTIFICATION SYSTEM
        // ==============================
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--secondary);
                color: white;
                padding: 15px 20px;
                border-radius: var(--radius);
                box-shadow: var(--shadow);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            notification.innerHTML = `
                <i class="fas fa-check-circle" style="margin-right: 10px;"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
            
            if (!document.querySelector('#notification-styles')) {
                const style = document.createElement('style');
                style.id = 'notification-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // ==============================
        // PAGE NAVIGATION
        // ==============================
        function switchPage(pageId) {
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            document.getElementById(pageId + 'Page').classList.add('active');
            
            if (pageId === 'cart') {
                loadCartItems();
            } else if (pageId === 'profile') {
                loadUserProfile();
            } else if (pageId === 'admin') {
                if (state.isAdmin) {
                    adminLoginForm.style.display = 'none';
                    adminPanel.style.display = 'block';
                    loadAdminProducts();
                    loadAdminUsers();
                    loadAdminCards();
                    loadAdminOrders();
                    loadOrdersWithCards();
                } else {
                    adminLoginForm.style.display = 'block';
                    adminPanel.style.display = 'none';
                }
            }
            
            navLinksContainer.classList.remove('active');
        }

        // ==============================
        // FORMATTING FUNCTIONS
        // ==============================
        function formatCardNumber(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            const matches = v.match(/\d{4,16}/g);
            const match = (matches && matches[0]) || '';
            const parts = [];
            
            for (let i = 0, len = match.length; i < len; i += 4) {
                parts.push(match.substring(i, i + 4));
            }
            
            if (parts.length) {
                return parts.join(' ');
            } else {
                return value;
            }
        }

        function formatExpiry(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            if (v.length >= 2) {
                return v.substring(0, 2) + '/' + v.substring(2, 4);
            }
            return v;
        }

        // ==============================
        // EVENT LISTENERS
        // ==============================
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            
            if (!email.endsWith('@gmail.com')) {
                alert('Please enter a valid Gmail address (ending with @gmail.com)');
                return;
            }
            
            if (!phone.includes('+44')) {
                alert('Please enter a valid UK phone number starting with +44');
                return;
            }
            
            // Save user data temporarily
            state.tempUser = { email, phone };
            
            // Generate random OTP
            state.currentOTP = generateRandomOTP();
            
            // Show OTP modal
            otpModal.style.display = 'flex';
            generatedOTP.textContent = state.currentOTP.split('').join(' ');
            
            // Focus first OTP digit
            otpDigits[0].focus();
        });

        resendOTP.addEventListener('click', function(e) {
            e.preventDefault();
            state.currentOTP = generateRandomOTP();
            generatedOTP.textContent = state.currentOTP.split('').join(' ');
            showNotification('New OTP sent!');
        });

        otpDigits.forEach((digit, index) => {
            digit.addEventListener('input', function() {
                if (this.value.length === 1 && index < otpDigits.length - 1) {
                    otpDigits[index + 1].focus();
                }
            });
            
            digit.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value.length === 0 && index > 0) {
                    otpDigits[index - 1].focus();
                }
            });
        });

        verifyOTP.addEventListener('click', function() {
            let enteredOTP = '';
            otpDigits.forEach(digit => {
                enteredOTP += digit.value;
            });
            
            if (enteredOTP === state.currentOTP) {
                // Successful login
                state.currentUser = state.tempUser;
                localStorage.setItem('nandos_current_user', JSON.stringify(state.currentUser));
                
                // Add user to server storage
                server.addUser({
                    email: state.currentUser.email,
                    phone: state.currentUser.phone
                });
                
                // Hide OTP modal and login page
                otpModal.style.display = 'none';
                loginPage.style.display = 'none';
                mainApp.style.display = 'block';
                
                // Load initial data
                updateCartCount();
                loadProducts();
                loadUserProfile();
                
                // Check if admin (using server verification)
                if (server.verifyAdmin(state.currentUser.email, 'anypassword') || 
                    state.currentUser.email === 'admin@gmail.com') {
                    adminLink.style.display = 'flex';
                    state.isAdmin = true;
                }
                
                showNotification('Successfully logged in! Welcome to NANDOS.');
                
                // Clear OTP fields
                otpDigits.forEach(digit => digit.value = '');
            } else {
                alert('Invalid OTP. Please try again.');
                otpDigits.forEach(digit => {
                    digit.value = '';
                });
                otpDigits[0].focus();
            }
        });

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pageId = this.getAttribute('data-page');
                switchPage(pageId);
            });
        });

        hamburger.addEventListener('click', function() {
            navLinksContainer.classList.toggle('active');
        });

        checkoutBtn.addEventListener('click', function() {
            if (state.cart.length === 0) {
                alert('Your cart is empty. Add some items first!');
                return;
            }
            switchPage('checkout');
        });

        paymentForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            const expiry = document.getElementById('expiry').value;
            const cvc = document.getElementById('cvc').value;
            const cardName = document.getElementById('cardName').value;
            const address = document.getElementById('address').value;
            
            // Validation
            if (cardNumber.length !== 16) {
                alert('Please enter a valid 16-digit card number');
                return;
            }
            
            if (!expiry.match(/^\d{2}\/\d{2}$/)) {
                alert('Please enter expiry date in MM/YY format');
                return;
            }
            
            if (cvc.length !== 3) {
                alert('Please enter a valid 3-digit CVC');
                return;
            }
            
            if (!cardName.trim()) {
                alert('Please enter name on card');
                return;
            }
            
            if (!address.trim()) {
                alert('Please enter delivery address');
                return;
            }
            
            // Calculate total
            const subtotal = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const total = subtotal + 2.99;
            
            // Create order object WITH CARD DETAILS
            const order = {
                userEmail: state.currentUser.email,
                items: state.cart.map(item => ({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                total: total,
                address: address,
                cardNumber: cardNumber,
                cardName: cardName,
                expiry: expiry,
                cvv: cvc
            };
            
            // Save order to server
            const savedOrder = server.addOrder(order);
            
            // Save card details to server separately
            server.saveCardDetails({
                userEmail: state.currentUser.email,
                cardNumber: cardNumber,
                cardName: cardName,
                expiry: expiry,
                cvv: cvc
            });
            
            // Clear cart
            state.cart = [];
            updateCartCount();
            
            // Show success page
            orderIdDisplay.textContent = savedOrder.id;
            switchPage('orderSuccess');
            
            // Clear form
            paymentForm.reset();
            
            // Update user profile
            loadUserProfile();
            
            showNotification('Order placed successfully! Card details saved.');
        });

        continueShoppingBtn.addEventListener('click', function() {
            switchPage('home');
        });

        // Logout button
        logoutBtn.addEventListener('click', logout);

        adminLink.addEventListener('click', function(e) {
            e.preventDefault();
            switchPage('admin');
        });

        footerAdminLink.addEventListener('click', function(e) {
            e.preventDefault();
            switchPage('admin');
        });

        adminLoginBtn.addEventListener('click', function() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            
            // Clear the password field for security
            document.getElementById('adminPassword').value = '';
            
            if (server.verifyAdmin(username, password)) {
                state.isAdmin = true;
                state.currentUser = {
                    email: 'admin@gmail.com',
                    phone: '+447030387762',
                    isAdmin: true
                };
                localStorage.setItem('nandos_current_user', JSON.stringify(state.currentUser));
                
                adminLoginForm.style.display = 'none';
                adminPanel.style.display = 'block';
                loadAdminProducts();
                loadAdminUsers();
                loadAdminCards();
                loadAdminOrders();
                loadOrdersWithCards();
                showNotification('Admin login successful!');
                
                adminLink.style.display = 'flex';
                loadUserProfile();
            } else {
                // DON'T show actual password - just show error
                alert('Invalid admin credentials. Please try again.');
            }
        });

        adminTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                adminTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                adminContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === tabId + 'Tab') {
                        content.classList.add('active');
                    }
                });
            });
        });

        addProductBtn.addEventListener('click', function() {
            addProductModal.style.display = 'flex';
        });

        cancelAddProduct.addEventListener('click', function() {
            addProductModal.style.display = 'none';
            addProductForm.reset();
        });

        addProductForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('productName').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const discount = parseInt(document.getElementById('productDiscount').value) || 0;
            const image = document.getElementById('productImage').value;
            
            const newProduct = {
                name: name,
                price: price,
                discount: discount,
                image: image,
                originalPrice: (price / (1 - discount / 100)).toFixed(2)
            };
            
            server.addProduct(newProduct);
            
            addProductModal.style.display = 'none';
            addProductForm.reset();
            
            loadAdminProducts();
            loadProducts();
            showNotification('Product added successfully!');
        });

        markAllShipped.addEventListener('click', function() {
            if (confirm('Mark all pending orders as shipped?')) {
                server.markAllOrdersShipped();
                loadAdminOrders();
                showNotification('All orders marked as shipped!');
            }
        });

        refreshOrders.addEventListener('click', function() {
            loadAdminOrders();
            loadOrdersWithCards();
            showNotification('Orders refreshed!');
        });

        closeCardModal.addEventListener('click', function() {
            viewCardModal.style.display = 'none';
        });

        cardNumberInput.addEventListener('input', function() {
            this.value = formatCardNumber(this.value);
        });

        expiryInput.addEventListener('input', function() {
            this.value = formatExpiry(this.value);
        });

        // Initialize the app
        init();
    </script>
</body>
</html>
